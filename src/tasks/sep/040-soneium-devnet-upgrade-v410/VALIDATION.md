## Expected Domain and Message Hashes

First, we need to validate the domain and message hashes. These values should match both the values on your ledger and
the values printed to the terminal when you run the task.

> [!CAUTION]
>
> Before signing, ensure the below hashes match what is on your ledger.
>
> ### Proxy Admin Owner for Soneium Devnet (`0xFB0F8937A0d6999C67E8a01310eBf7fe1859205F`):
>
> - Domain Hash: `0xbb7710987add9bc4f5949e44bc3405df5cbd2c021caeb85ef000e46a8ef2c077`
> - Message Hash: `0x173a2d476c6833a2548638564495186bd4929321ca4666cb25907323ef164565`

## Understanding Task Calldata

This document provides a detailed analysis of the final calldata executed on-chain for the OPCM upgrade to v4.1.0.

By reconstructing the calldata, we can confirm that the execution precisely implements the approved upgrade plan with no unexpected modifications or side effects.

### Inputs to `opcm.upgrade()`

For each chain being upgraded, the `opcm.upgrade()` function is called with a tuple of three elements:

- SystemConfigProxy: `0xe4a8f005bc30ebd2b2ebb69843baef97c597dc00`
- ProxyAdmin: `0x4f0bb1e5f8d98078636f9c38af61128381762dbd`
- AbsolutePrestate: `0x038512e02c4c3f7bdaec27d00edf55b7155e0905301e1a88083e4e0a6764d54c`

Thus, the command to encode the calldata is:

```bash
cast calldata 'upgrade((address,address,bytes32)[])' "[(0xe4a8f005bc30ebd2b2ebb69843baef97c597dc00,0x4f0bb1e5f8d98078636f9c38af61128381762dbd,0x038512e02c4c3f7bdaec27d00edf55b7155e0905301e1a88083e4e0a6764d54c)]"
```

### Inputs to `Multicall3DelegateCall`

The output from the previous section becomes the `data` in the argument to the `Multicall3DelegateCall.aggregate3()` function.

This function is called with a tuple of three elements:

Call3 struct for Multicall3DelegateCall:

- `target`: `0xd07a89cf19869ce185a5ec173568ae8acd5d8c02` - Sepolia OPContractsManager v4.1.0
- `allowFailure`: false
- `callData`: `0xff2dd5a1...` (output from the previous section)

Command to encode:

```bash
cast calldata 'aggregate3((address,bool,bytes)[])' "[(0xd07a89cf19869ce185a5ec173568ae8acd5d8c02,false,0xff2dd5a100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000e4a8f005bc30ebd2b2ebb69843baef97c597dc000000000000000000000000004f0bb1e5f8d98078636f9c38af61128381762dbd038512e02c4c3f7bdaec27d00edf55b7155e0905301e1a88083e4e0a6764d54c)]"
```

The resulting calldata sent from the ProxyAdminOwner safe is thus:

```
0x82ad56cb000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000d07a89cf19869ce185a5ec173568ae8acd5d8c020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a4ff2dd5a100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000e4a8f005bc30ebd2b2ebb69843baef97c597dc000000000000000000000000004f0bb1e5f8d98078636f9c38af61128381762dbd038512e02c4c3f7bdaec27d00edf55b7155e0905301e1a88083e4e0a6764d54c00000000000000000000000000000000000000000000000000000000
```

## Validation

### `0x31e21180cf37994d0dd35bf20ecafe85563e1e13` (L1Erc721BridgeProxy) 
  
- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000001`
  - **After:** `0x0000000000000000000000000000000000000000000000000000000000000003`
  - **Summary:** 
  - **Detail:** 
    
- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000033`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x000000000000000000000000e4a8f005bc30ebd2b2ebb69843baef97c597dc00`
  - **Summary:** 
  - **Detail:** 
    
- **Key:**          `0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc`
  - **Decoded Kind:** `address`
  - **Before:** `0x7aE1d3BD877a4C5CA257404ce26BE93A02C98013`
  - **After:** `0x7f1d12fB2911EB095278085f721e644C1f675696`
  - **Summary:** ERC-1967 implementation slot
  - **Detail:** Standard slot for storing the implementation address in a proxy contract that follows the ERC-1967 standard.

  ---
  
### `0x524a22c07597aba5ae02fe0a5735ca82277cc6da` (AddressManagerImpl) 
  
- **Key:**          `0x515216935740e67dfdda5cf8e248ea32b3277787818ab59153061ac875c9385e`
  - **Before:** `0x0000000000000000000000005d5a095665886119693f0b41d8dfee78da033e8b`
  - **After:** `0x00000000000000000000000022d12e0faebd62d429514a65ebae32dd316c12d6`
  - **Summary:** 
  - **Detail:** 
  
  ---
  
### `0x5f2667d343ef0681621fda2d80682c1903672751` (OptimismPortalProxy) 
  
- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000001`
  - **After:** `0x0000000000000000000000000000000000000000000000000000000000000003`
  - **Summary:** 
  - **Detail:** 
  
- **Key:**          `0x000000000000000000000000000000000000000000000000000000000000003e`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x000000000000000000000000bd67b7a063506eeed52b5ac31467e45b59686227`
  - **Summary:** 
  - **Detail:** 
  
- **Key:**          `0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc`
  - **Decoded Kind:** `address`
  - **Before:** `0xB443Da3e07052204A02d630a8933dAc05a0d6fB4`
  - **After:** `0x381E729FF983FA4BCEd820e7b922d79bF653B999`
  - **Summary:** ERC-1967 implementation slot
  - **Detail:** Standard slot for storing the implementation address in a proxy contract that follows the ERC-1967 standard.

  ---
  
### `0x64ca3f414a691618f8263c35f26832a45314dc0f` (delayedWETH/ProxyOwner) 
  
- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x0000000000000000000000000000000000000000000000000000000000000001`
  - **Summary:** 
  - **Detail:** 
  
- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000004`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x000000000000000000000000e4a8f005bc30ebd2b2ebb69843baef97c597dc00`
  - **Summary:** 
  - **Detail:** 

- **Key:**          `0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc`
  - **Decoded Kind:** `address`
  - **Before:** `0x0000000000000000000000000000000000000000`
  - **After:** `0x33Dadc2d1aA9BB613A7AE6B28425eA00D44c6998`
  - **Summary:** ERC-1967 implementation slot
  - **Detail:** Standard slot for storing the implementation address in a proxy contract that follows the ERC-1967 standard.
  
- **Key:**          `0xb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d6103`
  - **Decoded Kind:** `address`
  - **Before:** `0x0000000000000000000000000000000000000000`
  - **After:** `0x4F0bb1e5F8D98078636f9c38aF61128381762DbD`
  - **Summary:** Proxy owner address
  - **Detail:** Standard slot for storing the owner address in a Proxy contract.
  
  ---
  
### `0xa623de2d9352c75c2e10f6cbf50e101deed3a301` (L1CrossDomainMessengerProxy) 
  
- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **Before:** `0x0000000000000000000000010000000000000000000000000000000000000000`
  - **After:** `0x0000000000000000000000030000000000000000000000000000000000000000`
  - **Summary:** 
  - **Detail:** 
  
- **Key:**          `0x00000000000000000000000000000000000000000000000000000000000000fe`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x000000000000000000000000e4a8f005bc30ebd2b2ebb69843baef97c597dc00`
  - **Summary:** 
  - **Detail:** 
 
  ---
  
### `0xbd67b7a063506eeed52b5ac31467e45b59686227` (anchorStateRegistry/ProxyAdmin) 
  
- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x00000000000000000000e4a8f005bc30ebd2b2ebb69843baef97c597dc000001`
  - **Summary:** 
  - **Detail:** 

- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000001`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x000000000000000000000000ef77ae71ff7f533970910342c71692a3bdc74eac`
  - **Summary:** 
  - **Detail:** 
  
- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000003`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x73458284e6daf1be54ab7a795864f8155ab48864ff3e8b4e839c4d9362b943d0`
  - **Summary:** 
  - **Detail:** 

- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000004`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x0000000000000000000000000000000000000000000000000000000000617379`
  - **Summary:** 
  - **Detail:** 

- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000006`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x0000000000000000000000000000000000000000000000006913f8a800000000`
  - **Summary:** 
  - **Detail:** 

- **Key:**          `0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc`
  - **Decoded Kind:** `address`
  - **Before:** `0x0000000000000000000000000000000000000000`
  - **After:** `0xeb69cC681E8D4a557b30DFFBAd85aFfD47a2CF2E`
  - **Summary:** ERC-1967 implementation slot
  - **Detail:** Standard slot for storing the implementation address in a proxy contract that follows the ERC-1967 standard.
  
- **Key:**          `0xb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d6103`
  - **Decoded Kind:** `address`
  - **Before:** `0x0000000000000000000000000000000000000000`
  - **After:** `0x4F0bb1e5F8D98078636f9c38aF61128381762DbD`
  - **Summary:** Proxy owner address
  - **Detail:** Standard slot for storing the owner address in a Proxy contract.

  ---
  
### `0xc1d449c21883f05451c3cec0c1ed22d876eb0289` (L1StandardBridgeProxy) 
  
- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000001`
  - **After:** `0x0000000000000000000000000000000000000000000000000000000000000003`
  - **Summary:** 
  - **Detail:** 

- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000034`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x000000000000000000000000e4a8f005bc30ebd2b2ebb69843baef97c597dc00`
  - **Summary:** 
  - **Detail:** 

- **Key:**          `0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc`
  - **Decoded Kind:** `address`
  - **Before:** `0x0b09ba359A106C9ea3b181CBc5F394570c7d2a7A`
  - **After:** `0xe32B192fb1DcA88fCB1C56B3ACb429e32238aDCb`
  - **Summary:** ERC-1967 implementation slot
  - **Detail:** Standard slot for storing the implementation address in a proxy contract that follows the ERC-1967 standard.

  ---
  
### `0xe4a8f005bc30ebd2b2ebb69843baef97c597dc00` (SystemConfigProxy) 
  
- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000001`
  - **After:** `0x0000000000000000000000000000000000000000000000000000000000000003`
  - **Summary:** 
  - **Detail:** 

- **Key:**          `0x000000000000000000000000000000000000000000000000000000000000006b`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x000000000000000000000000000000000000000000000000000000000002bbee`
  - **Summary:** 
  - **Detail:** 

- **Key:**          `0x000000000000000000000000000000000000000000000000000000000000006c`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x000000000000000000000000c92831eb4544053dc330ab2cd4164e1eb3157a8e`
  - **Summary:** 
  - **Detail:** 

- **Key:**          `0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc`
  - **Decoded Kind:** `address`
  - **Before:** `0x340f923E5c7cbB2171146f64169EC9d5a9FfE647`
  - **After:** `0x2bFE4A5Bd5A41e9d848d843ebCDFa15954e9A557`
  - **Summary:** ERC-1967 implementation slot
  - **Detail:** Standard slot for storing the implementation address in a proxy contract that follows the ERC-1967 standard.

- **Key:**          `0x52322a25d9f59ea17656545543306b7aef62bc0cc53a0e65ccfa0c75b97aa906`
  - **Decoded Kind:** `address`
  - **Before:** `0xef77AE71ff7F533970910342C71692a3Bdc74eAc`
  - **After:** `0x0000000000000000000000000000000000000000`
  - **Summary:** DisputeGameFactory proxy address
  - **Detail:** Unstructured storage slot for the address of the DisputeGameFactory proxy.

  ---
  
### `0xe51111d47c7aa26c4b0f4ffe61ccf9122824ece9` (delayedWETH) 
  
- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x0000000000000000000000000000000000000000000000000000000000000001`
  - **Summary:** 
  - **Detail:** 

- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000004`
  - **Before:** `0x0000000000000000000000000000000000000000000000000000000000000000`
  - **After:** `0x000000000000000000000000e4a8f005bc30ebd2b2ebb69843baef97c597dc00`
  - **Summary:** 
  - **Detail:** 

- **Key:**          `0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc`
  - **Decoded Kind:** `address`
  - **Before:** `0x0000000000000000000000000000000000000000`
  - **After:** `0x33Dadc2d1aA9BB613A7AE6B28425eA00D44c6998`
  - **Summary:** ERC-1967 implementation slot
  - **Detail:** Standard slot for storing the implementation address in a proxy contract that follows the ERC-1967 standard.

- **Key:**          `0xb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d6103`
  - **Decoded Kind:** `address`
  - **Before:** `0x0000000000000000000000000000000000000000`
  - **After:** `0x4F0bb1e5F8D98078636f9c38aF61128381762DbD`
  - **Summary:** Proxy owner address
  - **Detail:** Standard slot for storing the owner address in a Proxy contract.
  
  ---
  
### `0xef77ae71ff7f533970910342c71692a3bdc74eac` (DisputeGameFactoryProxy) 
  
- **Key:**          `0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc`
  - **Decoded Kind:** `address`
  - **Before:** `0x4bbA758F006Ef09402eF31724203F316ab74e4a0`
  - **After:** `0x33D1e8571a85a538ed3D5A4d88f46C112383439D`
  - **Summary:** ERC-1967 implementation slot
  - **Detail:** Standard slot for storing the implementation address in a proxy contract that follows the ERC-1967 standard.

- **Key:**          `0x4d5a9bd2e41301728d41c8e705190becb4e74abe869f75bdb405b63716a35f9e`
  - **Before:** `0x000000000000000000000000ce0bf968e7071bf7c64d1c7f5f52e925f97726e9`
  - **After:** `0x00000000000000000000000085b8e387e0f3856594c9872df205a7cce76fea2d`
  - **Summary:** 
  - **Detail:** 

- **Key:**          `0xffdfc1249c027f9191656349feb0761381bb32c9f557e01f419fd08754bf5a1b`
  - **Before:** `0x000000000000000000000000abbe3c5bc7e55eed751828f357b7acd489c6a05c`
  - **After:** `0x0000000000000000000000007f1908f487c499ef2d7c5c684e1f03c1ec1f335f`
  - **Summary:** 
  - **Detail:** 

  ---
  
### `0xfb0f8937a0d6999c67e8a01310ebf7fe1859205f` (Unknown (GnosisSafe)) 
  
- **Key:**          `0x0000000000000000000000000000000000000000000000000000000000000005`
  - **Decoded Kind:** `uint256`
  - **Before:** `40`
  - **After:** `41`
  - **Summary:** nonce
  - **Detail:** 
  
  ━━━━━ Attention: Copy content above this line into the VALIDATION.md file. ━━━━━
  
  TASK CALLDATA
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  0x82ad56cb000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000d07a89cf19869ce185a5ec173568ae8acd5d8c020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a4ff2dd5a100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000e4a8f005bc30ebd2b2ebb69843baef97c597dc000000000000000000000000004f0bb1e5f8d98078636f9c38af61128381762dbd038512e02c4c3f7bdaec27d00edf55b7155e0905301e1a88083e4e0a6764d54c00000000000000000000000000000000000000000000000000000000
  
  
  SAFE (DEPTH: 0)
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  Safe Address:    SONEIUM_DEVNET_ProxyAdminOwner @0xFB0F8937A0d6999C67E8a01310eBf7fe1859205F
  Safe Hash:       0x349476ca4c0902e16ec18b710ded3b64c5fecc4cf8e70dd6c54c1c8e06cdbd1c
  Domain Hash:     0xbb7710987add9bc4f5949e44bc3405df5cbd2c021caeb85ef000e46a8ef2c077
  Message Hash:    0x173a2d476c6833a2548638564495186bd4929321ca4666cb25907323ef164565
  
  DATA TO SIGN
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  vvvvvvvv
  0x1901bb7710987add9bc4f5949e44bc3405df5cbd2c021caeb85ef000e46a8ef2c077173a2d476c6833a2548638564495186bd4929321ca4666cb25907323ef164565
  ^^^^^^^^
